## 单页应用程序 (Single Page Application)
- `单页`应用简称 `SPA` 应用, 指的是在`一个`页面上`集成`多种功能
- 整个网站使用`一个`页面作为框架`主体`, 所有的业务功能都以特定的方式`挂载`到这个主体上

#### 大致原理
- 前端通过 `H5` 特定技术可`监听 url` 的变化, 然后`阻止`掉浏览器`默认`的整体刷新`行为`
- 接下来前端根据变化后的 url, 使用 `Ajax` 技术`加载`视图, 然后进行替换
- `单页`应用是 `Ajax` 技术的进一步升华, 把 Ajax 的`无刷新`机制发挥到极致, 因此能造就与`桌面`程序`媲美`的流畅用户体验

#### 代表例子
- [网易云音乐](http://music.163.com)
    + 在线播放音乐, 切换页面时音乐不会停止, 因为页面无刷新
- [bootstrap中文文档](https://v3.bootcss.com/)
    + 不同文档页面进行切换, 页面无刷新

#### 单页面优缺点

###### 优点
- **节省http与资源开销**
    + `重复`性的`资源`只需加载执行一次, 比如公共的css与js`一次加载执行`, 多页面同享
- **提高页面响应速度**
    + `公共`的`页面`部分无需重新渲染, 比如公共的页面头部底部与导航, `一次渲染`, 多页面共享渲染结果
- **前后端分离**
    + `前端`自己实现`路由`功能, `移除`对后端路由设计的`依赖`
- **适当减轻后端压力**
    + 大部分页面`数据`采用 ajax 方式获取, 然后使用`前端`模版引擎进行`渲染`,` 节省`后端渲染的`开销`

###### 缺点
- **不利于SEO**
    + 爬虫只能从`渲染后`的页面中`抓取`信息
    + 但是 SPA 单页应用需要先在`浏览器`环境下`渲染`后才能供爬虫爬取数据
    + 而爬虫在爬取时无法给应用提供浏览器环境, 造成爬取失败
- **首页体验不佳**
    + SPA 单页应用在第一次访问时, 就会先`加载全部`的资源文件, 导致首页打开`速度过慢`
    + 因为单页应用的数据渲染由前端完成, 所以需要`等待 js` 加载完毕后才会`渲染`, 导致首页`白屏时间过长`

###### 补充
- 对于单页应用的缺点, 目前也都有了比较成熟的解决方案来应对
- 对于SEO, 不是所有的网站都需要, 如果需要, 我们可以利用请求头等方式区分爬虫, 然后有针对性的返回
- 对于首页资源加载过重, 我们可以分离非公共部分的资源, 转为按需加载
- 对于首页白屏时长, 我们可以把首页的渲染任务交给后端处理, 直接让后端返回渲染后的html, 然后前端解决其他页面的渲染
- 解决这些缺点可能仍然需要与后端做一些配合, 不过我们可以自己使用Node做中间层处理这些问题

#### 模拟实现单页应用

###### hash的概念
- `hash` 是前端 `url` 组成的一部分, 使用 `#` 号表示, 比如 `http://www.163.com/game?page=2#jingling`
- `hash` 最初的`作用`是定位页面中的元素, 实现`页面内`的`跳转`, 定位时需保证 `hash` 值与某个元素 `ID` 一致
- 最常见的`使用场景`就是点击 a 标签, 使 hash 发生变化, 然后页面跳转到指定的位置
- 实际上 `hash` 的变化是`不会`引起浏览器`刷新`的, 因为它是页面内的跳转, 我们可以手动修改浏览器地址栏中的 hash 进行测试

```html
<body>
    <a href="#mother">找妈妈</a>
    <a href="#father">找爸爸</a>
    <ul>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
        <li id="mother">青蛙妈妈</li>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
        <li id="father">青蛙爸爸</li>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
        <li>小蝌蚪</li>
    </ul>
</body>
```

###### hashchange事件
- 在最新的 `html5` 标准当中, 给 `window` 对象新增了一个 `hashchange` 事件
- 当 `hash` 发生`变化`时这个事件就会`触发`, 利用该事件可以很方便的实现`单页面`应用
- 备注: 如果没有该事件, 我们也可以通过定时器, 每隔一定时间检测 url 的变化来实现

```html
<body>
    <a href="#mother">找妈妈</a>
    <a href="#father">找爸爸</a>
</body>
<script type="text/javascript">
window.onhashchange = function() {
   console.log('hash变化为:' + location.hash);
};
</script>
```
