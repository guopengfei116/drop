# 防坑指南

### 语法

正确解析：a:if={{xxx}} 
错误解析：a:if={{ xxx }}
建议写法：a:if="{{ xxx }}"

### TabBar

在App.json文件中配置了tabBar属性后，死活没有出现底部导航，最后发现是因为pages属性配置的第一页面必须为Tab首页，而我在tabBar里面配置的是其它页面，导致默认打开的是首页，而首页不属于tabBar，所以一直没有效果。

总结就是：pages里面配置的第一个页面路径，必须在tabBar中进行配置，且必须一致（加与不加前缀）。

### Form表单

该问题只出现在IDE中，假设有一个Form表单，里面使用了`input-item`输入框组件，在输入中文后，点击提交按钮有可能拿不到含有中文的新值，如果是数字或字母则没有问题。

经测试，在真机中不存在该问题，所以开发测试时，准备一台真机进行预览以防万一。

### 图片不显示

默认的小程序项目模板，在app.json里面会有默认的首页配置，但是这个配置的路径前缀并没有`/`或者`./`，让我以为在小程序里没有特殊描述默认就是从项目根目录开始找的。

然后我在编写页面时，因为用到了图片，然后在页面data中定义了图片路径，死活没有出来，同样的路径我把它配置到App.json的tabBar中就可以正常显示。后来我猜测是路径解析的问题，就在页面data定义的路径加上`/`前缀，问题得以解决。最后我在App.json中，也加上`/`前缀测试是否也可行，结果告诉我一切正常，所以无论什么路径，统一加前缀是好的。

总结就是：凡是路径，一定要加上`/`绝对和`./`相对前缀。

### 路径问题 - {App.json} 与 {页面.json}

后来发现，IDE 对文件有缓存，如果修改了某个文件的路径，这个文件的原路径仍然可用，造成错误无法及时显现，后续出现造成困扰。所以为了保证应用运行无误，避免后期埋坑，一旦目录结构或者文件名称有变动，那么一定要按刷新按钮(清除缓存)。

也因为此后来发现，App.json 中的路径不能添加`/`前缀，所以这里的 pages 和 tabBar 配置走默认的不能加`/`前缀是最可靠的，加了可能会报`References Error：Page is not defined`错误。

`页面.json` 和 `页面.js` 中使用的路径，一定要加前缀。

### 应用上传 - 文件命名限制

应用上传时需要保证文件或者文件夹名称内没有 `@` 符号，否则无法上传。这个情况主要发生在 UI 给的 icon 图片，一般有 @2x 和 @3x 高清图，需要事先告诉 UI，尽量使用 - 分割符，或者自行修改。

### 应用上传 - 项目大小限制

项目大小不能超过 5MB，否则无法上传，用户首页使用体验也不好。另外的项目需要使用eslint和其它工具，一个eslint依赖就突破了 5MB 的限制，所以最后决定把 E应用 整体代码放置到 src 目录下，上传真机测试时只把 src 目录上传。

只把 src 目录上传还有一个问题，就是项目如果依赖了 npm 包，那么就会出现问题，因为现在项目依赖少，只有一个 UI 包，同时项目进度赶，所以目前就简单的把包下载下来一起放置到了 src 目录下，将来有时间要集成 webpack 或其它构建工具，自动化处理。

### HTTP

如果发送Post请求，默认情况下数据格式为formData，现在我们的接口都统一采用了json格式，所以需要手动配置`Content-Type: application/json`请求头。

改完之后还有一个巨大的坑，在IDE开发工具中发送Post请求没有任何问题，但是在真机里，还是不成功，原因是真机不会自动根据Content-type进行数据格式转换，所以还需要手动JSON.stringify(data)。

总结：Post请求如果接口要求json格式，那么设置Content-Type请求头，然后手动把数据JSON.stringify序列化。

### 日期问题

在真机当中，日期组件是无法精确到秒的，如果需要只能手动补齐。

### IOS日期问题

这里的问题在IDE开发工具和Android真机中没有，只在ISO有问题，但是这些问题即不是逻辑错误，也不是语法错误，也不会引起报错的兼容性bug，简直让人吐血...

一、

IOS不支持点分隔符作为日期参数，比如：`new Date(2018.10.10)`。

二、

IOS只支持`2018.10.10`，不支持简写日期`2018.1.1`。

三、

IOS完整时间只支持`2018-02-02T02:02:02`，不支持`2018-02-02 02:02:02`

简写一样不支持`2018-02-02T2:2:2`, `2018-02-02 2:2:2`。

四、

在IOS中调起日期组件，任意选择一个日期，然后点击屏幕，我们的潜意识是取消日期选择操作，但实际上IOS认为你选择了一个空日期，并且会把空值传给成功回调。

五、

在IOS中，创建一个日期对象，默认它会认为是UTC时间，然后会根据你的时区进行转换，比如`new Date('2018-11-11T00:00:00')`，
然后你得到的时间为`2018-11-11 08:00:00`，那是因为中国北京在东八区，你的手机可能设置的日区是北京，所以IOS帮你做了转换。

这样在一个和普遍的场景下就会出现问题：比如通过`Date.now()`获取当前时间的时间戳，这个返回值没有任何问题，完全是按照本地的当前时间来计算的；然后你通过`new Date(一个动态的时间字符串).getTime()`或者`Date.parse(一个动态的时间字符串)`方法转换时间戳，然后两种对比，就会不准备！因为后面的方法让你的时间戳增加了8小时。

总结：

1、创建Date对象，如果需要传参，传递以横杠作为分隔符的参数，比如`2018-10-10`。
2、日期插件，在成功回调中要对用户选取的日期做空值判断

### data数据

在IDE中经过测试，一个页面如果被销毁了，那么它的数据不会马上回收，比如在某个页面内通过`this.data.a = 1`这种方式修改数据，退出该页面重新进入，你会发现值仍然被保留。

还没有在真机中测试，如果真机也一样，那么这可能是App的缓存机制，为了让打开过的页面能够更快的渲染和初始化，杀掉应用进程的话，数据才会被清除。
