# Cookie的概念
> Cookie是存储在用户本地客户端上的一小段文本信息，
当用户访问某个站点时，这段文本信息会自动被传递给站点服务器。

### Cookie的作用
http协议本身是无状态的，对于一个浏览器发出的多次请求，WEB服务器无法区分是不是来源于同一个浏览器。
如果需要区分的话，需要额外的数据用于维护与记录。 Cookie正是这样的一段随HTTP请求一起被传递的额外数据。

这就像是你开一家小卖店，客人和你买东西，你并不会刻意去记录今天有哪些客人和你买了东西，这就可以认为是无状态的。
但这样可能会有一个问题，如果有客人找你退货，你如何分辨东西就是从你这里购买的呢？
一个通用的解决方案就是客人从你这买东西后，你给客人一张独特的小票，如果发生退货必须持有此小票才可以；
当然，如果客户持有该小票，你也可以给他们适当的优惠，这样客户每次购物时都会携带这张小票。

Cookie作用就类似于这张小票，在web开发中，会经常通过Cookie来进行用户登陆状态的保存。

### Cookie的注意事项
- Cookie只能是一段字符串，因为会随着请求被自动发送到服务器，所以不应太大。
- Cookie是明文存储的，大部分浏览器都提供了用户自我修改功能，所以不适合保存重要或隐私的内容。

### Cookie的大小限制
大多数浏览器对Cookie的存储都做了最大限制，基本为4096字节，即4K。
同时大多数浏览器对每个站点的Cookie数量也做了限制，基本为20个，后续新的Cookie会替换旧的Cookie。

### 关于Cookie的写入 -- 重点
因为Cookie一般是用于维持服务端会话(会话即一直保持练习)状态的，
所以一般是由服务端发起并写入浏览器的，就像小票是由卖主交给买主的，
然后在后续的请求中，供服务端读取。

# Cookie使用
- 虽然大多数Cookie是服务端进行存储和使用的，
但是在前端我们也可以通过js来操作Cookie，供【服务端】或者【自己】使用，
如果供自己使用，则作用类似于H5新增的localStorage。

### 存储与修改
- 在服务端可以利用不同语言提供的API来进行Cookie存储。
但最终原理都是服务端通过http响应头来告诉浏览器存储指定Cookie。
- 在前端可以使用document.cookie属性添加Cookie，
注意：cookie一次只能添加一个，给cookie赋值时与一般的对象属性赋值不同。

### 使用
- 浏览器在发送请求时，会自动在请求头中添加Cookie信息发送给服务器使用。
但是发送Cookie时，会检查Cookie的域名(Domain)与路径(Path)设置，与网站域名匹配后才会发送。
比如我们访问www.163.com时，浏览器是不会把baidu.com的Cookie发送过去的。
- 如果在前端使用，则可以通过document.cookie得到该域名下所有Cookie，
然后根据Cookie规则使用字符串相关方法提取指定值。

### 删除
- Cookie有一个过期(Expires)设置，如果设置此Cookie过期时间为当前时间之前，那么浏览器就会删除它。

### 格式与配置
> 设置cookie时，要求是一个字符串。字符串中以分号“;”对cookie键值进行分隔。
第一对键值用来表示cookie数据，后续键值是对cookie的一些设置。
- domain：有效域名，默认为当前2级域名
- path：有效路径，默认为/
- expires：到期时间，默认为一个会话
- max-age：最新代替expires的配置项，设置有效时间，单位秒
- secure：是否只在https协议下传输cookie，默认false
```javascript
    // 存储的数据格式如果比较特殊可以使用encodeURIComponent方法进行编码
	document.cookie = 'data=gezhongshuju' 
		+ ';domain=baidu.com'
		+ ';path=/'
		+ ';expires=' + new Date('2017-3-15')
		+ ';max-age=' + 60 * 60 * 24
		+ ';secure=true';
```

# Session(会话)
> Session是存储在服务端的数据，这个数据称所以称之为Session(会话)，
是因为该数据的生命周期通常为客户端与服务端的一次会话。
当会话结束不久后服务端就会删除该数据，这里我们作为前端了解即可。

### Session的作用
前面说到了cookie的作用，可以用来在客户端记录一些数据，
这些数据通常是由服务端设置的，服务端使用它的目的是为了给不同的客户端增加一个标识符，
然后根据这些标识符找到一些相关数据进行处理，这些相关数据就是Session。
通常情况下，只要服务端使用了浏览器的cookie，那么对应就一定会在本地使用session。

### Session与cookie的关系
服务端要使用session技术，就必须要在客户端记录一些数据来配合，cookie就充当了这样一个角色。
虽然后续出现了很多新技术与技术改进，session也不一定非得依赖cookie，
但是到目前为止这对好基友的激情依旧没有消散。

### Session与Cookie实现登陆状态保留
- 假设小卖店卖货，很火，需要排队；那么1小时前有个人排了半天队终于买到了东西，
现在又要来买一些，这人就带着他的购买小票说，我刚买东西不久，也排了半天队，
能否给个快速通道啊，结果老板就给他设计了快速购买通道。
- 登陆也是类型，当我们第一次输入账号密码时，服务端就会给我们一个小票(cookie),
之前我们再向服务端索要数据时，带着小票就不用输入账号密码了，
通过小票(cookie)服务端已经知道我们刚刚登陆过，并认出了我们的角色，
然后就直接返回给我们相应的请求数据。

### Session与Cookie关系理解其他参考例子
笔者曾经常去的一家咖啡店有喝5杯咖啡免费赠一杯咖啡的优惠，然而一次性消费5杯咖啡的机会微乎其微，这时就需要某种方式来纪录某位顾客的消费数量。想象一下其实也无外乎下面的几种方案： 
1、该店的店员很厉害，能记住每位顾客的消费数量，只要顾客一走进咖啡店，店员就知道该怎么对待了。这种做法就是协议本身支持状态。 
2、发给顾客一张卡片，上面记录着消费的数量，一般还有个有效期限。每次消费时，如果顾客出示这张卡片，则此次消费就会与以前或以后的消费相联系起来。这种做法就是在客户端保持状态。 
3、发给顾客一张会员卡，除了卡号之外什么信息也不纪录，每次消费时，如果顾客出示该卡片，则店员在店里的纪录本上找到这个卡号对应的纪录添加一些消费信息。这种做法就是在服务器端保持状态。 

由于HTTP协议是无状态的，而出于种种考虑也不希望使之成为有状态的，
因此，后面两种方案就成为现实的选择。具体来说cookie机制采用的是在客户端保持状态的方案，
而session机制采用的是在服务器端保持状态的方案。
同时我们也看到，由于采用服务器端保持状态的方案在客户端也需要保存一个标识，
所以session机制可能需要借助于cookie机制来达到保存标识的目的，但实际上它还有其他选择。 
